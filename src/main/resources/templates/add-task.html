<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>افزودن تسک</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: "Vazir", "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        }
        /* Toast container fixed top */
        #toast-container {
            position: fixed;
            top: 1rem;
            left: 50%;
            transform: translateX(-50%);
            z-index: 9999;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            max-width: 350px;
            width: 90vw;
        }
    </style>
</head>
<body class="bg-gradient-to-r from-indigo-400 via-purple-500 to-pink-500 min-h-screen flex flex-col items-center justify-center p-6">

<div class="bg-white bg-opacity-90 backdrop-blur-md rounded-xl shadow-xl p-8 max-w-md w-full">
    <h1 class="text-3xl font-bold mb-6 text-center text-gray-900">افزودن تسک جدید</h1>
    <form id="taskForm" class="flex flex-col gap-5">
        <label for="title" class="block text-gray-700 font-semibold">عنوان تسک</label>
        <input id="title" name="title" type="text" placeholder="عنوان تسک را وارد کنید"
               class="w-full py-3 px-4 rounded border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-600"/>

        <label for="description" class="block text-gray-700 font-semibold">توضیحات</label>
        <textarea id="description" name="description" placeholder="توضیحات تسک"
                  class="w-full py-3 px-4 rounded border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-600"></textarea>

        <button type="submit"
                class="mt-4 bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 rounded shadow transition">
            افزودن تسک
        </button>
    </form>
</div>

<!-- Toast notification container -->
<div id="toast-container" aria-live="assertive" aria-atomic="true"></div>

<script>
    const form = document.getElementById('taskForm');
    const toastContainer = document.getElementById('toast-container');

    // Function to create and show toast message
    function showToast(message, isError = false) {
        const toast = document.createElement('div');
        toast.className = `p-4 rounded shadow text-white ${isError ? 'bg-red-800' : 'bg-green-800'} animate-fadein`;
        toast.textContent = message;

        toastContainer.appendChild(toast);

        // Remove toast after 4 seconds
        setTimeout(() => {
            toast.classList.add('animate-fadeout');
            toast.addEventListener('animationend', () => toast.remove());
        }, 4000);
    }

    form.addEventListener('submit', async e => {
        e.preventDefault();
        const title = form.title.value.trim();
        const description = form.description.value.trim();

        // Basic client side validation
        if (!title) {
            showToast('عنوان تسک نمی‌تواند خالی باشد', true);
            return;
        }

        const payload = { title, description };

        try {
            const response = await fetch('/tasks/add', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            if (response.ok) {
                showToast('تسک با موفقیت اضافه شد');
                form.reset();
            } else if (response.status === 409) {
                // Try to get validation error messages from response
                const errors = await response.json();
                if (Array.isArray(errors)) {
                    errors.forEach(err => {
                        showToast(err.message || 'خطا در ورود داده‌ها', true);
                    });
                } else {
                    showToast('خطای سرور: لطفاً دوباره تلاش کنید', true);
                }
            } else {
                showToast('خطای ناشناخته رخ داده است', true);
            }
        } catch (error) {
            showToast('اتصال به سرور برقرار نشد', true);
        }
    });
</script>

<!-- Toast fade-in/out animation -->
<style>
    @keyframes fadein {
        from {opacity: 0; transform: translateY(-10px);}
        to {opacity:1; transform: translateY(0);}
    }
    @keyframes fadeout {
        from {opacity: 1; transform: translateY(0);}
        to {opacity:0; transform: translateY(-10px);}
    }
    .animate-fadein {
        animation: fadein 0.3s ease forwards;
    }
    .animate-fadeout {
        animation: fadeout 0.3s ease forwards;
    }
</style>
</body>
</html>
